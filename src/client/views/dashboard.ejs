<% layout('layout') -%>
<div class="center-large-box">
  <h1>Dashboard</h1>
  <div id="center-large-box-left">
    <div id="application-tab-item" class="left-tab selected">
      Application
    </div>
    <div id="cubstart-tab-item" class="left-tab">
      Cubstart
    </div>
    <div id="team-tab-item" class="left-tab">
      Team
    </div>
    <div id="logout-tab-item" class="left-tab" onClick="location.href='/logout'">
      Logout
    </div>
  </div>
  <div id="center-large-box-right">

    <div id="application-tab" class="tab tab-visible">
      <%
      var app = user.Application
      if (app) { %>
        <p><b>Your application to Cal Hacks 5.0 is all set!</b> If you want to make changes, you can still edit your application before the deadline, October 8th.</p>
        <div class="button-justified">
          <button onclick="location.href='/application';">Edit Application</button>
        </div>
      <% } else { %>
        <p><b>Thanks for creating an account with us!</b> To be considered for Cal Hacks 5.0, please fill out our application form.</p>
        <p>The deadline to complete your application is:<br/>
        <b>9/24</b> for out-of-state students<br/>
        <b>10/1</b> for out-of-area students in California<br/>
        <b>10/8</b> for Berkeley students</p>
        <div class="button-justified">
          <button onclick="location.href='/application';">Start Application</button>
        </div>
      <% } %>
    </div>

    <div id="team-tab" class="tab">
      <%
      if (user.Team) { %>
        <div>
          <p>Team name: <b><%= user.Team.name %></b></p>
          <% for (var u of user.Team.Users) { %>
            <p class="team-member"><b><%= u.firstname + ' ' + u.lastname %></b><%=' (' + u.email + ')' %></p>
          <% } %>
        </div>
        <div class="button-justified">
          <form method="post" action="/leaveTeam">
            <button type="submit">Leave Team</button>
          </form>
        </div>
      <% } else { %>
        <p>To join a team (or create a team if it doesn't exist), type your team name below.</p>
        <form name="team" method="post" action="/team">
          <input type="text" name="name"
            value="<%= user.Team ? user.Team.name : '' %>"
            placeholder="Team name"/>
          <input type="submit" value="Submit" />
        </form>
        <% if (flash.error) { %>
          <div
            class="flash-container">
            <%= flash.error %>
          </div>
        <% } %>
      <% } %>
    </div>

    <div id="cubstart-tab" class="tab">
      <%
       if (user.CubStart) { %>
         <p><b>Your application to Cubstart at Cal Hacks 5.0 is all set!</b> If you want to make changes, you can still edit your application before the deadline, October 8th.</p>
         <div class="button-justified">
           <button onclick="location.href='/cubstart';">Edit Cubstart app</button>
         </div>
      <% } else { %>
        <p>You have not completed your application to CubStart yet.</p>
        <p>CubStart is a beginning hacker program to help hackathons less intimidating and more accessible for everyone. We provide a mentorship program for team building, ideation, basic hackathon skills, and technical workshops to encourage those with little or no CS experience to try out hackathons and coding! <b>If you're a first-time hacker, we highly recommend that you apply.</b></p>
        <div class="button-justified">
          <button onclick="location.href='/cubstart';">Start Cubstart Application</button>
        </div>
      <% } %>
    </div>

  </div>
</div>

<script>
var tabNames = ['application', 'team', 'cubstart'];

function setTab(tabName) {
  $(".left-tab").attr("class", "left-tab");
  $("#" + tabName + "-tab-item").addClass("selected")
  $(".tab").attr("class", "tab");
  $("#" + tabName + "-tab").addClass("tab-visible");
  window.location.hash = tabName;
}

$(".left-tab").on("click", function() {
  var tabName = $(this).attr("id").split("-")[0];
  setTab(tabName);
});

var hash = window.location.hash.substr(1);
if (tabNames.indexOf(hash) !== -1) {
  setTab(hash);
} else {
  setTab(tabNames[0]);
}
</script>
