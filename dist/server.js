!function(e){var t={};function n(r){if(t[r])return t[r].exports;var a=t[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},n.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n.w={},n(n.s=36)}([function(e,t,n){"use strict";n(22).config();var r=n(2),a={};!function(e){if(Object.keys(a).length&&!force)return a;var t=new r(e.database,e.username,e.password,e);[n(20),n(19),n(18)].forEach(function(n){var o=n.default(t,r,e);a[o.name]=o}),Object.keys(a).forEach(function(e){"associate"in a[e]&&a[e].associate(a)}),a.sequelize=t,a.Sequelize=r,t.sync()}(n(21).default.production),e.exports=a},function(e,t){e.exports=require("bcrypt-nodejs")},function(e,t){e.exports=require("sequelize")},function(e,t){e.exports=require("@sendgrid/mail")},function(e,t){e.exports=require("passport")},function(e,t){e.exports=require("babel-register")},function(e,t){e.exports=require("fs")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){return"\n<p>\nDear "+e+",\n<br/>\n<br/>\n<strong>Thanks so much for making an account with us!</strong><br/>\nTo make sure it's you, please verify your email at this link:\n<a href=\"https://2018.calhacks.io/verify?code="+t+'">\n    https://2018.calhacks.io/verify?code='+t+"\n</a><br/>\nIf you didn't make an account on the Cal Hacks portal, please ignore this email!\n</p>\n"}},function(e,t){e.exports=require("passport-local")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i(n(1)),a=n(8),o=i(n(3)),s=i(n(7));function i(e){return e&&e.__esModule?e:{default:e}}t.default=function(e,t){if(process.env.SENDGRID_APIKEY){o.default.setApiKey(process.env.SENDGRID_APIKEY),e.serializeUser(function(e,t){t(null,e.id)}),e.deserializeUser(function(e,n){t.findOne({where:{id:e}}).then(function(e){e?n(null,e.get()):n(e.errors,null)})});e.use("local-signup",new a.Strategy({usernameField:"email",passwordField:"password",passReqToCallback:!0},function(e,n,a,i){t.findOne({where:{email:n}}).then(function(u){if(u)return i(null,!1,{message:"That email is already taken."});var l=function(e){return r.default.hashSync(e,r.default.genSaltSync(8),null)}(a),c=function(){for(var e="",t=0;t<10;t++)e+="QWERTYUIOPASDFGHJKLZXCVBNM1234567890"[Math.floor(26*Math.random())];return e}(),d={email:n,password:l,firstname:e.body.firstname,lastname:e.body.lastname,emailCode:c,emailValidated:!1,role:"hacker"};o.default.send({to:n,from:"team@calhacks.io",subject:"Verify your email with Cal Hacks",html:(0,s.default)(e.body.firstname+" "+e.body.lastname,c)}),t.create(d).then(function(e,t){return e?i(null,e,{}):i(null,!1,{message:"There was an unexpected error creating an account."})}).catch(function(e){return console.log(e)})})})),e.use("local-signin",new a.Strategy({usernameField:"email",passwordField:"password",passReqToCallback:!0},function(e,n,a,o){t.findOne({where:{email:n}}).then(function(e){if(!e||(t=e.password,n=a,!r.default.compareSync(n,t)))return o(null,!1,{message:"Incorrect username/password"});var t,n,s=e.get();return o(null,s)}).catch(function(e){console.log("Something went wrong:"),console.log(e),o(null,!1,{message:"Something went wrong"})})}))}else console.error("ERROR: Must define SENDGRID_APIKEY")}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.emailVerify=t.authenticateUser=void 0;n(0),t.authenticateUser=function(e){return function(t,n,r){void 0!==t.user&&e.includes(t.user.role)?r():n.redirect("/login")}},t.emailVerify=function(e,t,n){e.user.emailValidated?n():t.redirect("/inform_verify")}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(10);t.default={"/inform_verify":{get:[(0,r.authenticateUser)(["hacker","admin"])],post:[(0,r.authenticateUser)(["hacker","admin"])]},"/dashboard":{get:[(0,r.authenticateUser)(["hacker","admin"]),r.emailVerify],post:[(0,r.authenticateUser)(["hacker","admin"]),r.emailVerify]},"/application":{get:[(0,r.authenticateUser)(["hacker","admin"]),r.emailVerify],post:[(0,r.authenticateUser)(["hacker","admin"]),r.emailVerify]},"/team":{post:[(0,r.authenticateUser)(["hacker","admin"]),r.emailVerify]},"/leaveTeam":{post:[(0,r.authenticateUser)(["hacker","admin"]),r.emailVerify]}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},a=n(0);t.default={cubstart:function(e,t,n){a.User.findOne({where:{id:e.user.id},include:[{model:a.Application},{model:a.Team,include:[a.User]}]}).then(function(e){t.render("cubstart",{user:e.toJSON()})})},submitApp:function(e,t,n){a.User.findOne({where:{id:e.user.id},include:{model:a.Application}}).then(function(n){null===n.Application?a.Application.create(r({},e.body,{UserId:e.user.id})).then(function(e){t.redirect("/dashboard")}):n.Application.updateAttributes(e.body).then(function(n){console.log(e.body),t.redirect("/dashboard")})})}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);t.default={submitTeam:function(e,t,n){r.Team.findOne({where:{name:e.body.name},include:{model:r.User}}).then(function(n){null===n?r.Team.create({name:e.body.name}).then(function(n){n.addUser(e.user.id).then(function(e){t.redirect("/dashboard#team")})}):n.Users.length<4?n.addUser(e.user.id).then(function(e){t.redirect("/dashboard#team")}):e.flash("error","That team is already at the maximum of 4 members.")})},leaveTeam:function(e,t,n){r.User.findOne({where:{id:e.user.id},include:{model:r.Team}}).then(function(e){e.setTeam(null).then(function(e){t.redirect("/dashboard#team")})})}}},function(e,t){e.exports=require("fs-extra")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},o=n(14),s=(r=o)&&r.__esModule?r:{default:r},i=n(0);t.default={submitApp:function(e,t,n){var r=function(){var t=e.files.resume;if(0!==t.size){var n=t.name.split("."),r=void 0;r=n.length>1?e.user.id+"."+n[n.length-1]:""+e.user.id;var a=t.path,o="/tmp/calhacks/portal/resumes/"+r;return s.default.move(a,o,{overwrite:!0})}return Promise.resolve()};i.User.findOne({where:{id:e.user.id},include:{model:i.Application}}).then(function(n){null===n.Application?i.Application.create(a({},e.body,{UserId:e.user.id})).then(function(e){r().then(function(){console.log("File moved successfully!"),t.redirect("/dashboard")}).catch(function(e){console.log(e),t.redirect("/dashboard")})}):n.Application.updateAttributes(e.body).then(function(n){console.log(e.body),r().then(function(){console.log("File moved successfully!"),t.redirect("/dashboard")}).catch(function(e){console.log(e),t.redirect("/dashboard")})})})},appPage:function(e,t){i.User.findOne({where:{id:e.user.id},include:[{model:i.Application}]}).then(function(e){t.render("application",{user:e.toJSON()})})}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);t.default={dashboard:function(e,t,n){r.User.findOne({where:{id:e.user.id},include:[{model:r.Application},{model:r.Team,include:[r.User]}]}).then(function(e){t.render("dashboard",{user:e.toJSON()})})}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){return"\n<p>\nDear "+e+',\n<br/>\n<br/>\nYou can reset your password by clicking on the link below:\n<a href="https://2018.calhacks.io/reset?code='+t+'">\n    https://2018.calhacks.io/reset?code='+t+"\n</a><br/>\nIf you didn't request a new password, please ignore this email!\n</p>\n"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var n=e.define("Team",{name:{type:t.STRING,validate:{notEmpty:!0},allowNull:!1}});return n.associate=function(e){e.Team.hasMany(e.User)},n}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var n=e.define("Application",{phone:{type:t.TEXT,validate:{notEmpty:!0}},gender:{type:t.TEXT,validate:{notEmpty:!0}},school:{type:t.TEXT,validate:{notEmpty:!0}},year:{type:t.TEXT,validate:{notEmpty:!0}},major:{type:t.TEXT,validate:{notEmpty:!0}},transportation:{type:t.TEXT,validate:{notEmpty:!0}},allergies:{type:t.TEXT},shirt:{type:t.TEXT,validate:{notEmpty:!0}},links:{type:t.TEXT},hackathons:{type:t.TEXT,validate:{notEmpty:!0}},hearAbout:{type:t.TEXT,validate:{notEmpty:!0}},cubstart:{type:t.TEXT,validate:{notEmpty:!0}},cubstart1:{type:t.TEXT},cubstart2:{type:t.TEXT},cubstart3:{type:t.TEXT},cubstart4:{type:t.TEXT},question1:{type:t.TEXT},question2:{type:t.TEXT},question3:{type:t.TEXT},beginner:{type:t.TEXT},status:{type:t.ENUM("inreview","accepted","rejected","waitlisted"),defaultValue:"inreview"}},{});return n.associate=function(e){e.Application.belongsTo(e.User)},n}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var n=e.define("User",{firstname:{type:t.STRING,notEmpty:!0},lastname:{type:t.STRING,notEmpty:!0},email:{type:t.STRING,notEmpty:!0,validate:{isEmail:!0}},password:{type:t.STRING,allowNull:!1},emailCode:{type:t.STRING,notEmpty:!0,unique:!0},emailValidated:{type:t.BOOLEAN},role:{type:t.ENUM("hacker","admin"),notEmpty:!0},resetPasswordCode:{type:t.STRING},resetPasswordExpiration:{type:t.DATE}},{});return n.associate=function(e){e.User.hasOne(e.Application),e.User.belongsTo(e.Team)},n}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={development:{username:process.env.DB_USER,password:process.env.DB_PASSWD,database:process.env.DB_NAME,host:process.env.DB_HOST,dialect:"mysql"},production:{username:process.env.DB_USER,password:process.env.DB_PASSWD,database:process.env.DB_NAME,host:process.env.DB_HOST,dialect:"mysql"}}},function(e,t){e.exports=require("dotenv")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=u(n(4)),a=u(n(3)),o=n(0),s=u(n(17)),i=u(n(1));function u(e){return e&&e.__esModule?e:{default:e}}var l=n(2);t.default={signIn:function(e,t,n){return t.render("login")},signUp:function(e,t,n){return t.render("signup")},logout:function(e,t,n){return e.session.destroy(function(e){t.redirect("/")})},submitLogin:function(e,t,n){r.default.authenticate("local-signin",function(r,a,o){return null!==r?(e.flash("error","There was an unexpected error signing in."),n(r)):a?void e.logIn(a,function(r){return r?(e.flash("error","There was an unexpected error signing in."),n(r)):t.redirect("/dashboard")}):(e.flash("error","Invalid email/password combination."),t.redirect("/login"))})(e,t,n)},submitSignup:function(e,t,n){r.default.authenticate("local-signup",function(r,a,o){return null!==r?(e.flash("error",JSON.stringify(r)),n(r)):a?void e.logIn(a,function(r){return r?(e.flash("error","There was an unexpected error creating an account."),n(r)):t.redirect("/dashboard")}):(e.flash("error",o.message),t.redirect("/signup"))})(e,t,n)},validate:function(e,t,n){o.User.update({emailValidated:!0},{where:{emailCode:e.query.code}}).then(function(e){console.log(e),0==e[0]?t.render("verify",{success:!1}):t.render("verify",{success:!0})})},informVerify:function(e,t,n){return t.render("informVerify",{user:e.user})},informReset:function(e,t,n){return t.render("informReset",{user:e.user})},resetPassword:function(e,t,n){return t.render("resetPassword")},submitReset:function(e,t,n){o.User.findOne({where:{email:e.body.email}}).then(function(n){if(!n)return e.flash("error","There is no user associated with that email."),t.redirect("/reset_password");var r=function(){for(var e="",t=0;t<10;t++)e+="QWERTYUIOPASDFGHJKLZXCVBNM1234567890"[Math.floor(26*Math.random())];return e}(),i=e.body.email;a.default.send({to:i,from:"team@calhacks.io",subject:"Reset your password for Cal Hacks",html:(0,s.default)(n.firstname+" "+n.lastname,r)}),o.User.update({resetPasswordCode:r,resetPasswordExpiration:new Date},{where:{email:i}}).then(function(e){t.render("informReset",{user:n})})})},changePassword:function(e,t,n){return t.render("changePassword",{code:e.query.code})},submitPassword:function(e,t,n){console.log(e.query);var r,a,s,u,c=new Date;c.setHours(c.getHours()-1),console.log("hello"),o.User.update({password:(u=e.body.password,i.default.hashSync(u,i.default.genSaltSync(8),null))},{where:{resetPasswordCode:e.query.code,resetPasswordExpiration:(r={},a=l.Op.gt,s=c,a in r?Object.defineProperty(r,a,{value:s,enumerable:!0,configurable:!0,writable:!0}):r[a]=s,r)}}).then(function(e){0==e[0]?t.render("newPassword",{success:!1}):t.render("newPassword",{success:!0})})},newPassword:function(e,t,n){return t.render("newPassword")}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={home:function(e,t,n){t.render("home")}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=l(n(24)),a=l(n(23)),o=l(n(16)),s=l(n(15)),i=l(n(13)),u=l(n(12));function l(e){return e&&e.__esModule?e:{default:e}}t.default={"/":{get:r.default.home},"/login":{get:a.default.signIn,post:a.default.submitLogin},"/signup":{get:a.default.signUp,post:a.default.submitSignup},"/logout":{get:a.default.logout},"/verify":{get:a.default.validate},"/inform_verify":{get:a.default.informVerify},"/reset_password":{get:a.default.resetPassword,post:a.default.submitReset},"/reset":{get:a.default.changePassword,post:a.default.submitPassword},"/newPassword":{get:a.default.newPassword},"/dashboard":{get:o.default.dashboard},"/application":{get:s.default.appPage,post:s.default.submitApp},"/cubstart":{get:u.default.cubstart,post:u.default.submitApp},"/team":{post:i.default.submitTeam},"/leaveTeam":{post:i.default.leaveTeam}}},function(e,t){e.exports=require("chain-middleware")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=i(n(26)),o=i(n(25)),s=i(n(11));function i(e){return e&&e.__esModule?e:{default:e}}t.default=[function(e,t,n){var i=e.path,u=e.method.toLowerCase(),l=o.default[i];if(!l)return t.status(404).send("page not found");if(!l[u])return t.status(404).send("cannot "+u+" "+e.path);if(s.default[i]&&s.default[i][u]){var c=void 0;c="object"===r(s.default[i][u])?s.default[i][u].concat([o.default[i][u]]):[s.default[i][u],o.default[i][u]],a.default.apply(void 0,function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(c))(e,t,n)}else o.default[i][u](e,t,n)}]},function(e,t){e.exports=require("req-flash")},function(e,t){e.exports=require("node-sass-middleware")},function(e,t){e.exports=require("ejs-mate")},function(e,t){e.exports=require("formidable")},function(e,t){e.exports=require("express-session")},function(e,t){e.exports=require("path")},function(e,t){e.exports=require("express")},function(e,t,n){"use strict";var r=p(n(34)),a=(p(n(33)),p(n(32))),o=p(n(4)),s=p(n(31)),i=p(n(30)),u=p(n(29)),l=p(n(28)),c=p(n(27)),d=p(n(0)),f=p(n(9));function p(e){return e&&e.__esModule?e:{default:e}}var m=n(6),h=(0,r.default)();n(5)({presets:["env"]}),h.use((0,a.default)({secret:"keyboard cat",resave:!0,saveUninitialized:!0})),h.use((0,l.default)({locals:"flash"})),h.use(o.default.initialize()),h.use(o.default.session()),h.use(r.default.static("./dist")),h.use(function(e,t,n){var r=new s.default.IncomingForm({maxFileSize:10485760});r.once("error",console.log),r.parse(e,function(t,r,a){Object.assign(e,{fields:r,files:a}),e.body=e.fields,n()})}),h.engine("ejs",i.default),h.set("view engine","ejs"),h.set("views","src/client/views"),(0,f.default)(o.default,d.default.User),h.use((0,u.default)({src:"src/client/assets",dest:"dist/assets",indentedSyntax:!0,debug:!0})),h.use(r.default.static("dist/assets")),h.use("/",c.default),m.unlink("/srv/apps/hackthebay/hackthebay.sock",function(){console.log("cleared old socket")}),h.listen("/srv/apps/hackthebay/hackthebay.sock",function(){console.log("listening on unix socket"),m.chmodSync("/srv/apps/hackthebay/hackthebay.sock","777"),console.log("set permissions of socket to 777")})},function(e,t,n){e.exports=n(35)}]);